class SidebarMenu extends HTMLElement {
  constructor() {
    super();
    // 侧边栏HTML结构（原SIDEBAR部分）
    this.innerHTML = `
      <section id="sidebar">
        <a href="#" class="brand">
          <img src="./images/logo.png" class="icon-img" alt="Dashboard">
          <span class="text">河东琉云纪</span>
        </a>
        <ul class="side-menu top">
          <li class="active">
            <a href="index.html">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><g fill="none" fill-rule="evenodd"><path d="m12.593 23.258l-.011.002l-.071.035l-.02.004l-.014-.004l-.071-.035q-.016-.005-.024.005l-.004.01l-.017.428l.005.02l.01.013l.104.074l.015.004l.012-.004l.104-.074l.012-.016l.004-.017l-.017-.427q-.004-.016-.017-.018m.265-.113l-.013.002l-.185.093l-.01.01l-.003.011l.018.43l.005.012l.008.007l.201.093q.019.005.029-.008l.004-.014l-.034-.614q-.005-.018-.02-.022m-.715.002a.02.02 0 0 0-.027.006l-.006.014l-.034.614q.001.018.017.024l.015-.002l.201-.093l.01-.008l.004-.011l.017-.43l-.003-.012l-.01-.01z"/><path fill="currentColor" d="M15.993 3c.404 0 .753.238.915.582l.042.106c.308.917 1.265 1.309 2.042 1.312c.719.003 1.12.684.974 1.258c-.317 1.251-.983 1.976-1.662 2.363a3 3 0 0 1-.304.151V11h.559a1.5 1.5 0 0 1 1.488 1.314L20.883 19H21a1 1 0 1 1 0 2h-6.922A1.08 1.08 0 0 1 13 19.922V18a1 1 0 1 0-2 0v1.922C11 20.517 10.517 21 9.922 21H3a1 1 0 0 1 0-2h.117l.836-6.686A1.5 1.5 0 0 1 5.441 11H6V8.772a3 3 0 0 1-.304-.151c-.679-.387-1.345-1.112-1.662-2.363c-.146-.574.255-1.255.974-1.258c.729-.003 1.615-.348 1.977-1.146l.065-.166c.134-.4.512-.688.957-.688zm2.124 10H5.883l-.75 6H9v-1a3 3 0 1 1 6 0v1h3.867zM16 9H8v2h8zm-.646-4H8.646C8.125 5.921 7.3 6.458 6.49 6.74a1 1 0 0 0 .534.26h9.954a1 1 0 0 0 .534-.26c-.81-.282-1.636-.819-2.157-1.74Z"/></g></svg>
              <span class="text">首页</span>
            </a>
          </li>
          <li>
            <a href="ai3d.html">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><g fill="none" stroke="currentColor" stroke-width="1.5"><path stroke-linecap="round" d="M5.143 14A7.8 7.8 0 0 1 4 9.919C4 5.545 7.582 2 12 2s8 3.545 8 7.919A7.8 7.8 0 0 1 18.857 14"/><path d="M7.383 17.098c-.092-.276-.138-.415-.133-.527a.6.6 0 0 1 .382-.53c.104-.041.25-.041.54-.041h7.656c.291 0 .436 0 .54.04a.6.6 0 0 1 .382.531c.005.112-.041.25-.133.527c-.17.511-.255.767-.386.974a2 2 0 0 1-1.2.869c-.238.059-.506.059-1.043.059h-3.976c-.537 0-.806 0-1.043-.06a2 2 0 0 1-1.2-.868c-.131-.207-.216-.463-.386-.974ZM15 19l-.13.647c-.14.707-.211 1.06-.37 1.34a2 2 0 0 1-1.113.912C13.082 22 12.72 22 12 22s-1.082 0-1.387-.1a2 2 0 0 1-1.113-.913c-.159-.28-.23-.633-.37-1.34L9 19"/><path stroke-linecap="round" stroke-linejoin="round" d="m12.308 12l-1.461-4.521A.72.72 0 0 0 10.154 7a.72.72 0 0 0-.693.479L8 12m7-5v5m-6.462-1.5h3.231"/></g></svg>
              <span class="text">龙门琉云坊</span>
            </a>
          </li>
          <li>
            <a href="cloud.html">
              <svg t="1758205030404" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5058" xmlns:xlink="http://www.w3.org/1999/xlink" width="28" height="28"><path d="M785.3 516.6c-5.1 0-10.3-1.2-15.2-3.7-16.2-8.4-22.5-28.3-14.1-44.5 17.7-34 21.1-72.9 9.5-109.5s-36.7-66.5-70.7-84.2c-34-17.7-72.9-21.1-109.5-9.5-36.6 11.6-66.5 36.7-84.2 70.7-8.4 16.2-28.3 22.5-44.5 14.1s-22.5-28.3-14.1-44.5c25.8-49.7 69.5-86.4 122.9-103.2 53.4-16.9 110.2-12 159.9 13.9 49.7 25.8 86.4 69.5 103.2 122.9 16.9 53.4 12 110.2-13.9 159.9-5.9 11.1-17.4 17.6-29.3 17.6z" fill="#4E4D4D" p-id="5059"></path><path d="M769.4 831.7c-105.1 0-190.6-85.5-190.6-190.6 0-18.2 14.8-33 33-33s33 14.8 33 33c0 68.7 55.9 124.5 124.5 124.5 68.7 0 124.5-55.9 124.5-124.5S838 516.6 769.4 516.6c-16 0-31.5 3-46.2 8.8-17 6.8-36.1-1.5-42.9-18.4-6.8-16.9 1.5-36.1 18.4-42.9 22.5-9 46.3-13.5 70.7-13.5 105.1 0 190.6 85.5 190.6 190.6s-85.6 190.5-190.6 190.5z" fill="#4E4D4D" p-id="5060"></path><path d="M408.1 831.7H273.7C158.1 831.7 64 737.6 64 622s94.1-209.7 209.7-209.7h161.4c115.6 0 209.7 94.1 209.7 209.7 0 18.2-14.8 33-33 33s-33-14.8-33-33c0-79.2-64.4-143.6-143.6-143.6H273.7c-79.2 0-143.6 64.4-143.6 143.6s64.4 143.6 143.6 143.6h134.4c18.2 0 33 14.8 33 33 0 18.3-14.7 33.1-33 33.1z" fill="#4E4D4D" p-id="5061"></path><path d="M408.1 655h-86.2c-18.2 0-33-14.8-33-33s14.8-33 33-33h86.2c18.2 0 33 14.8 33 33s-14.7 33-33 33z" fill="#4E4D4D" p-id="5062"></path><path d="M369.7 702.8c-8.4 0-16.9-3.2-23.3-9.7l-47.8-47.8c-12.9-12.9-12.9-33.8 0-46.7 12.9-12.9 33.8-12.9 46.7 0l47.8 47.8c12.9 12.9 12.9 33.8 0 46.7-6.5 6.5-15 9.7-23.4 9.7z" fill="#4E4D4D" p-id="5063"></path><path d="M408.1 831.7c-18.2 0-33-14.8-33-33s14.8-33 33-33c30.5 0 55.3-24.8 55.3-55.3S438.6 655 408.1 655c-18.2 0-33-14.8-33-33s14.8-33 33-33c66.9 0 121.3 54.4 121.3 121.3S475 831.7 408.1 831.7zM611.8 674.1c-18.2 0-33-14.8-33-33V616c0-18.2 14.8-33 33-33s33 14.8 33 33v25.1c0 18.2-14.8 33-33 33z" fill="#4E4D4D" p-id="5064"></path></svg>
              <span class="text">走进琉云</span>
            </a>
          </li>
          <li>
            <a href="kilnfire.html">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 36 36"><path fill="currentColor"   d="M27.843 11.9q.31-.557.548-1.183c1.209-3.187.467-6.423-1.658-7.229c-1.588-.602-3.499.326-4.868 2.164c-.397-1.141-.548-2.209-.092-2.652h-8.228c.455.443.304 1.511-.093 2.652c-1.369-1.838-3.28-2.766-4.868-2.164c-2.125.806-2.868 4.042-1.659 7.229c.158.418.344.812.548 1.183c-1.184 1.166-2.157 2.879-2.157 5.563c0 6.17 8.227 13.39 9.256 15.447c-.126.045 6.297.045 6.171 0C21.773 30.852 30 23.633 30 17.462c0-2.683-.973-4.396-2.157-5.562M11.488 9.214c-.382.382-1.333.768-2.377 1.418a5 5 0 0 1-.299-.631c-.617-1.624-.237-3.272.845-3.683c.931-.354 2.076.329 2.772 1.559c-.335.585-.673 1.069-.941 1.337m15.017.787a5 5 0 0 1-.299.632c-1.044-.65-1.995-1.036-2.377-1.418c-.268-.268-.606-.753-.94-1.337c.695-1.23 1.841-1.913 2.772-1.559c1.081.41 1.461 2.058.844 3.682"/><path fill="#272B2B" d="M18.546 31.747H16.63c-2.057 0-5.142.971-5.142 3.027c0 1.029 3.942 1.143 6.085 1.143h.032c2.143 0 6.084-.113 6.084-1.143c-.001-2.056-3.085-3.027-5.143-3.027M30 17.462c0-2.611-.923-4.299-2.063-5.462H7.38c-1.14 1.163-2.063 2.852-2.063 5.462c0 1.481.481 3.022 1.216 4.538h22.251C29.519 20.484 30 18.943 30 17.462M23.688 1.373c0-1.011-3.808-1.159-5.972-1.164H17.6c-2.164.005-5.972.152-5.972 1.164c0 2.013 3.796 2.942 5.887 2.982h.285c2.093-.041 5.888-.97 5.888-2.982"/><path fill="#C1694F" d="M13.031 20H10.46c-.284 0-.514-.216-.514-.5s.23-.5.514-.5H13v-4H9v1h2.488c.284 0 .514.216.514.5s-.23.5-.514.5H9.062C8.521 17 8 16.854 8 16.229v-1.315c0-.726.604-.914.888-.914h4.143c.698 0 .969.479.969.915v4.114c0 .617-.458.971-.969.971m14 0h-2.572c-.283 0-.514-.216-.514-.5s.231-.5.514-.5H27v-4h-4v1h2.488c.283 0 .514.216.514.5s-.231.5-.514.5h-2.426c-.541 0-1.062-.146-1.062-.771v-1.315c0-.726.604-.914.889-.914h4.143c.697 0 .968.479.968.915v4.114c0 .617-.458.971-.969.971m-7 0h-2.572c-.283 0-.514-.216-.514-.5s.231-.5.514-.5H20v-4h-4v1h2.488c.283 0 .514.216.514.5s-.231.5-.514.5h-2.426c-.541 0-1.062-.146-1.062-.771v-1.315c0-.726.604-.914.889-.914h4.143c.697 0 .968.479.968.915v4.114c0 .617-.458.971-.969.971"/></svg>
              <span class="text">千年窑火传</span>
            </a>
          </li>
          <li>
            <a href="mykiln.html">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path fill="currentColor" d="M12 12q-1.65 0-2.825-1.175T8 8t1.175-2.825T12 4t2.825 1.175T16 8t-1.175 2.825T12 12m-8 8v-2.8q0-.85.438-1.562T5.6 14.55q1.55-.775 3.15-1.162T12 13t3.25.388t3.15 1.162q.725.375 1.163 1.088T20 17.2V20z"/></svg>
              <span class="text">我的窑藏</span>
            </a>
          </li>
        </ul>
        <ul class="side-menu bottom">
          <li>
            <a href="#">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 24 24"><path fill="currentColor" d="m9.25 22l-.4-3.2q-.325-.125-.612-.3t-.563-.375L4.7 19.375l-2.75-4.75l2.575-1.95Q4.5 12.5 4.5 12.338v-.675q0-.163.025-.338L1.95 9.375l2.75-4.75l2.975 1.25q.275-.2.575-.375t.6-.3l.4-3.2h5.5l.4 3.2q.325.125.613.3t.562.375l2.975-1.25l2.75 4.75l-2.575 1.95q.025.175.025.338v.674q0 .163-.05.338l2.575 1.95l-2.75 4.75l-2.95-1.25q-.275.2-.575.375t-.6.3l-.4 3.2zm2.8-6.5q1.45 0 2.475-1.025T15.55 12t-1.025-2.475T12.05 8.5q-1.475 0-2.488 1.025T8.55 12t1.013 2.475T12.05 15.5"/></svg>
              <span class="text">设置</span>
            </a>
          </li>
          <li>
            <a href="#" class="logout">
              <svg xmlns="http://www.w3.org/2000/svg" width="28" height="28" viewBox="0 0 1024 1024"><path fill="currentColor" d="M521.7 82c-152.5-.4-286.7 78.5-363.4 197.7c-3.4 5.3.4 12.3 6.7 12.3h70.3c4.8 0 9.3-2.1 12.3-5.8c7-8.5 14.5-16.7 22.4-24.5c32.6-32.5 70.5-58.1 112.7-75.9c43.6-18.4 90-27.8 137.9-27.8s94.3 9.3 137.9 27.8c42.2 17.8 80.1 43.4 112.7 75.9s58.1 70.4 76 112.5C865.7 417.8 875 464.1 875 512s-9.4 94.2-27.8 137.8c-17.8 42.1-43.4 80-76 112.5s-70.5 58.1-112.7 75.9A352.8 352.8 0 0 1 520.6 866c-47.9 0-94.3-9.4-137.9-27.8A353.8 353.8 0 0 1 270 762.3c-7.9-7.9-15.3-16.1-22.4-24.5c-3-3.7-7.6-5.8-12.3-5.8H165c-6.3 0-10.2 7-6.7 12.3C234.9 863.2 368.5 942 520.6 942c236.2 0 428-190.1 430.4-425.6C953.4 277.1 761.3 82.6 521.7 82M395.02 624v-76h-314c-4.4 0-8-3.6-8-8v-56c0-4.4 3.6-8 8-8h314v-76c0-6.7 7.8-10.5 13-6.3l141.9 112a8 8 0 0 1 0 12.6l-141.9 112c-5.2 4.1-13 .4-13-6.3"/></svg>
              <span class="text">登录</span>
            </a>
          </li>
        </ul>
      </section>
    `;
  }

  // 组件挂载到页面后执行
  connectedCallback() {
    // 1. 初始化侧边栏逻辑
    this.initSidebar();
    // 2. 监听窗口大小变化（响应式）
    window.addEventListener('resize', this.adjustSidebar.bind(this));
    // 3. 初始调整一次
    this.adjustSidebar();
  }

  // 组件从页面移除时清理事件
  disconnectedCallback() {
    window.removeEventListener('resize', this.adjustSidebar.bind(this));
  }

  // 侧边栏核心逻辑（高亮、点击切换）
  initSidebar() {
    const sidebar = this.querySelector('#sidebar');
    const allLinks = sidebar.querySelectorAll('.side-menu li a');

    // 点击菜单切换高亮
    allLinks.forEach(link => {
      link.addEventListener('click', (e) => {
        // 移除所有active
        sidebar.querySelectorAll('.side-menu li').forEach(li => {
          li.classList.remove('active');
        });
        // 给当前点击的li添加active
        link.parentElement.classList.add('active');
      });
    });

    // 自动高亮当前页面菜单
    allLinks.forEach(link => {
      if (link.href && window.location.pathname.endsWith(link.getAttribute('href'))) {
        sidebar.querySelectorAll('.side-menu li').forEach(li => li.classList.remove('active'));
        link.parentElement.classList.add('active');
      }
    });
  }

  // 响应式调整侧边栏显示/隐藏
  adjustSidebar() {
    const sidebar = this.querySelector('#sidebar');
    if (window.innerWidth <= 576) {
      sidebar.classList.add('hide');
      sidebar.classList.remove('show');
    } else {
      sidebar.classList.remove('hide');
      sidebar.classList.add('show');
    }
  }
}

// 注册侧边栏组件
customElements.define('sidebar-menu', SidebarMenu);